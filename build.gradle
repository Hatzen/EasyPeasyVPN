/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 *
 * TODO: Reformat this file. 
 * TODO: Sign Jar file
 * TODO: Add obfusication
 */

import org.ajoberstar.gradle.git.tasks.*

apply plugin: 'idea'
apply plugin: 'java'

version = '1.0'
sourceCompatibility = 1.7
targetCompatibility = 1.7

// https://stackoverflow.com/a/27132701/8524651
buildscript {
       repositories { mavenCentral() }
       dependencies { 
		classpath 'org.ajoberstar:gradle-git:0.2.3'
 	}
    }

// Only needed once to update the Dependency.
// TODO: Refactor to git submodule (?)
task cloneNetACT(type: GitClone) {
            def destination = file("NetACT")
            uri = "https://github.com/Hatzen/NetACT"
            destinationPath = destination
            bare = false
            enabled = !destination.exists() //to clone only once
        }

//Get dependencies from Maven central repository
repositories {
    mavenCentral()
}

dependencies {
    		compile project(':NetACT')
}

// TODO: Clear folder before creating
javadoc {
    destinationDir = file("${rootDir}/doc/javadoc/")
    source = sourceSets.main.allJava
    classpath = configurations.compile
}

jar {
	dependsOn 'cloneNetACT'
	tasks.findByName('jar').mustRunAfter 'cloneNetACT'

    manifest {
        attributes 'Implementation-Title': 'EasyPeasyVPN',
                   'Implementation-Version': version,
		   'Main-Class': 'de.hartz.vpn.Main'
    }
}

task runJar2(dependsOn:jar) {
    doLast{
       javaexec { 
         main="-jar";
         args = [
            "C:/Users/nwuser/FitNesse/fitnesse-standalone.jar"
           ]
       } 
    }
  
}

task runJar(type: JavaExec) {
	dependsOn 'jar'
    main = "-jar";
    args jar.archivePath
}


task runNetACTest {
	dependsOn 'cloneNetACT'
	dependsOn 'jar'
	tasks.findByName('jar').mustRunAfter 'cloneNetACT'

    doLast{
       javaexec { 
         main="-jar";
         args = [
            "C:/Users/nwuser/FitNesse/fitnesse-standalone.jar"
           ]
       } 
    }
  
}